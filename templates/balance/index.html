{% extends "balance/base.html" %}
{% load bootstrap5 %}
{% load static %}
{% load sum %}

{% block header %}
  <h2>Баланс</h2>
{% endblock header %}

<link href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"> 

{% block content %}
  <form method="post" action="{% url 'balance' %}" class="form">
    {% csrf_token %}
    {% buttons %}
      <button class="btn btn-primary" name="submit">Запросить баланс</button>
    {% endbuttons %}
    <input type="hidden" name="next" value="{% url 'index' %}" />
  </form>
  <table class="table table-striped table-bordered" id="table1" border="1" style="width: 100%;">
    <thead class="thead-dark">
      <tr>
        <th>Время</th>
        <th>Rapira</th>
        <th>Garantex</th>
        <th>Cryptomus</th>
        <th>Bybit</th>
        <th>Whitebit</th>
        <th>Заморожено</th>
        <th>Всего</th>
      </tr>
    </thead>
    <tbody>
      {% for balance in balances %}
      <tr>
        <td>
          <script>
            var serverDate = new Date("{{ balance.date_created }}");
            // var localDate = new Date(serverDate.getTime() + serverDate.getTimezoneOffset() / 60000);
            var formattedDate = serverDate.toLocaleString();
            console.log("{{ balance.date_created }}")
            console.log(serverDate)
            document.write(formattedDate);
          </script>
        </td>
        <td>{{ balance.rapira|floatformat:2 }}</td>
        <td>{{ balance.garantex|floatformat:2 }}</td>
        <td>{{ balance.cryptomus|floatformat:2 }}</td>
        <td>
          <table class="table table-striped table-bordered" id="table1" border="1" style="width: 100%;">
            <thead>
              <tr>
                <th>Аккаунт</th>
                <th>USDT Balance</th>
                <th colspan="2">Общая сумма</th>
              </tr>
            </thead>
            <tbody>
                {% for column in balance.bybit %}
                <tr>
                  <td>{{column.account}}</td>
                  <td>{{column.result|floatformat:2 }}</td>
                {% endfor %}
                <td>{% total_sum balance.bybit%}</td>
                </tr>
            </tbody>
          </table>
        </td>
        <td>{{ balance.whitebit|floatformat:2 }}</td>
        <td>{{ balance.locked|floatformat:2 }}</td>
        <td>{{ balance.result|floatformat:2 }}</td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="8">Нет данных</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
{% endblock content %}



